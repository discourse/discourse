# Login and Registration UI

<details>
<summary>Relevant source files</summary>

The following files were used as context for generating this wiki page:

- [app/controllers/invites_controller.rb](https://github.com/discourse/discourse/blob/8c2d5f9a/app/controllers/invites_controller.rb)
- [app/controllers/session_controller.rb](https://github.com/discourse/discourse/blob/8c2d5f9a/app/controllers/session_controller.rb)
- [app/controllers/users/omniauth_callbacks_controller.rb](https://github.com/discourse/discourse/blob/8c2d5f9a/app/controllers/users/omniauth_callbacks_controller.rb)
- [app/controllers/users_controller.rb](https://github.com/discourse/discourse/blob/8c2d5f9a/app/controllers/users_controller.rb)
- [app/services/user_activator.rb](https://github.com/discourse/discourse/blob/8c2d5f9a/app/services/user_activator.rb)
- [app/services/user_authenticator.rb](https://github.com/discourse/discourse/blob/8c2d5f9a/app/services/user_authenticator.rb)
- [app/views/application/_header.html.erb](https://github.com/discourse/discourse/blob/8c2d5f9a/app/views/application/_header.html.erb)
- [config/initializers/009-omniauth.rb](https://github.com/discourse/discourse/blob/8c2d5f9a/config/initializers/009-omniauth.rb)
- [lib/middleware/omniauth_bypass_middleware.rb](https://github.com/discourse/discourse/blob/8c2d5f9a/lib/middleware/omniauth_bypass_middleware.rb)
- [plugins/discourse-apple-auth/spec/requests/auth_apple_spec.rb](https://github.com/discourse/discourse/blob/8c2d5f9a/plugins/discourse-apple-auth/spec/requests/auth_apple_spec.rb)
- [plugins/discourse-lti/lib/discourse_lti/lti_omniauth_strategy.rb](https://github.com/discourse/discourse/blob/8c2d5f9a/plugins/discourse-lti/lib/discourse_lti/lti_omniauth_strategy.rb)
- [plugins/discourse-lti/plugin.rb](https://github.com/discourse/discourse/blob/8c2d5f9a/plugins/discourse-lti/plugin.rb)
- [plugins/discourse-lti/spec/requests/lti_spec.rb](https://github.com/discourse/discourse/blob/8c2d5f9a/plugins/discourse-lti/spec/requests/lti_spec.rb)
- [spec/rails_helper.rb](https://github.com/discourse/discourse/blob/8c2d5f9a/spec/rails_helper.rb)
- [spec/requests/invites_controller_spec.rb](https://github.com/discourse/discourse/blob/8c2d5f9a/spec/requests/invites_controller_spec.rb)
- [spec/requests/omniauth_callbacks_controller_spec.rb](https://github.com/discourse/discourse/blob/8c2d5f9a/spec/requests/omniauth_callbacks_controller_spec.rb)
- [spec/requests/session_controller_spec.rb](https://github.com/discourse/discourse/blob/8c2d5f9a/spec/requests/session_controller_spec.rb)
- [spec/requests/users_controller_spec.rb](https://github.com/discourse/discourse/blob/8c2d5f9a/spec/requests/users_controller_spec.rb)
- [spec/services/user_authenticator_spec.rb](https://github.com/discourse/discourse/blob/8c2d5f9a/spec/services/user_authenticator_spec.rb)

</details>



## Purpose and Scope

This document covers the frontend user interface components and flows for user authentication in Discourse, including login forms, registration forms, social authentication, and form validation. This focuses specifically on the client-side UI components, controllers, and user experience flows.

For backend authentication models, user management, and server-side authentication logic, see [User Model and Authentication](#4.1). For broader user system architecture, see [User System](#4).

## Overview

The login and registration UI system provides comprehensive user authentication interfaces through multiple pathways: local account creation, social authentication, email-based login, and various specialized flows for invitations and external integrations.

### Core UI Architecture

```mermaid
graph TB
    subgraph "Route Layer"
        LoginRoute["login.js route"]
        SignupRoute["signup.js route"] 
        ApplicationRoute["application.js route"]
        InviteRoute["invites-show.js route"]
    end
    
    subgraph "Controller Layer"
        LoginController["LoginPageController"]
        SignupController["SignupPageController"]
        InviteController["InvitesShowController"]
    end
    
    subgraph "UI Components"
        LoginForm["Login Form"]
        SignupForm["Signup Form"]
        SocialButtons["Social Login Buttons"]
        UserFields["User Field Components"]
        FullnameInput["fullname-input.gjs"]
    end
    
    subgraph "Validation Helpers"
        UsernameHelper["UsernameValidationHelper"]
        PasswordHelper["PasswordValidationHelper"]
        UserFieldsHelper["UserFieldsValidationHelper"]
        NameHelper["NameValidationHelper"]
    end
    
    subgraph "Services"
        LoginService["login service"]
        AuthComplete["auth-complete.js"]
    end
    
    LoginRoute --> LoginController
    SignupRoute --> SignupController
    InviteRoute --> InviteController
    
    LoginController --> LoginForm
    SignupController --> SignupForm
    SignupController --> UserFields
    SignupController --> FullnameInput
    
    SignupForm --> UsernameHelper
    SignupForm --> PasswordHelper
    SignupForm --> UserFieldsHelper
    SignupForm --> NameHelper
    
    LoginController --> LoginService
    SignupController --> LoginService
    
    LoginService --> SocialButtons
    AuthComplete --> SignupController
    AuthComplete --> LoginController
```

**Sources:** [app/assets/javascripts/discourse/app/routes/login.js:1-94](https://github.com/discourse/discourse/blob/8c2d5f9a/app/assets/javascripts/discourse/app/routes/login.js#L1-L94), [app/assets/javascripts/discourse/app/routes/signup.js:1-107](https://github.com/discourse/discourse/blob/8c2d5f9a/app/assets/javascripts/discourse/app/routes/signup.js#L1-L107), [app/assets/javascripts/discourse/app/controllers/login.js:1-325](https://github.com/discourse/discourse/blob/8c2d5f9a/app/assets/javascripts/discourse/app/controllers/login.js#L1-L325), [app/assets/javascripts/discourse/app/controllers/signup.js:1-590](https://github.com/discourse/discourse/blob/8c2d5f9a/app/assets/javascripts/discourse/app/controllers/signup.js#L1-L590)

## Login UI Flow

The login interface supports multiple authentication methods and handles complex flows including two-factor authentication, password reset, and email-based login.

### Login Flow Architecture

```mermaid
graph TD
    Start["User visits /login"] --> LoginRoute["LoginRoute.beforeModel()"]
    LoginRoute --> CheckAuth{"Check external auth requirements"}
    
    CheckAuth -->|"Single external method"| ExternalRedirect["Redirect to external auth"]
    CheckAuth -->|"Discourse Connect"| SSO["Redirect to SSO"]
    CheckAuth -->|"Show form"| LoginController["LoginPageController"]
    
    LoginController --> LoginForm["Render login form"]
    LoginForm --> LocalLogin["localLogin() action"]
    LoginForm --> PasskeyLogin["passkeyLogin() action"]
    LoginForm --> SocialAuth["externalLogin() action"]
    
    LocalLogin --> Validate{"Validate credentials"}
    Validate -->|"Success"| CheckTwoFA{"Two-factor required?"}
    Validate -->|"Error"| ShowError["Display error flash"]
    
    CheckTwoFA -->|"Yes"| TwoFactorUI["Show second factor form"]
    CheckTwoFA -->|"No"| LoginSuccess["loginSuccess()"]
    
    TwoFactorUI --> TwoFactorSubmit["Submit TOTP/Security Key"]
    TwoFactorSubmit --> LoginSuccess
    
    LoginSuccess --> HiddenForm["Submit hidden-login-form"]
    HiddenForm --> Redirect["Redirect to destination"]
```

**Sources:** [app/assets/javascripts/discourse/app/routes/login.js:22-80](https://github.com/discourse/discourse/blob/8c2d5f9a/app/assets/javascripts/discourse/app/routes/login.js#L22-L80), [app/assets/javascripts/discourse/app/controllers/login.js:187-298](https://github.com/discourse/discourse/blob/8c2d5f9a/app/assets/javascripts/discourse/app/controllers/login.js#L187-L298)

### Login Controller Features

The `LoginPageController` manages multiple authentication states and methods:

| Property | Purpose |
|----------|---------|
| `loggingIn` | Tracks form submission state |
| `showSecondFactor` | Controls 2FA UI visibility |
| `showSecurityKey` | Controls WebAuthn UI |
| `loginName` | Username/email input value |
| `loginPassword` | Password input value |
| `secondFactorToken` | TOTP/backup code value |

**Key Methods:**
- `localLogin()` - Handles username/password authentication at [app/assets/javascripts/discourse/app/controllers/login.js:187-298]()
- `passkeyLogin()` - WebAuthn/passkey authentication at [app/assets/javascripts/discourse/app/controllers/login.js:119-154]()
- `externalLogin()` - Social authentication trigger at [app/assets/javascripts/discourse/app/controllers/login.js:301-307]()

**Sources:** [app/assets/javascripts/discourse/app/controllers/login.js:23-325](https://github.com/discourse/discourse/blob/8c2d5f9a/app/assets/javascripts/discourse/app/controllers/login.js#L23-L325)

## Registration/Signup UI Flow

The signup system provides comprehensive account creation with validation, custom fields, social authentication, and invite-based registration.

### Signup Flow Architecture

```mermaid
graph TD
    Start["User visits /signup"] --> SignupRoute["SignupRoute.beforeModel()"]
    SignupRoute --> CheckAccess{"Can user sign up?"}
    
    CheckAccess -->|"Invite only"| Block["Block signup"]
    CheckAccess -->|"Single external"| ExtRedirect["External auth redirect"]  
    CheckAccess -->|"Allow"| SignupController["SignupPageController"]
    
    SignupController --> InitHelpers["Initialize validation helpers"]
    InitHelpers --> RenderForm["Render signup form"]
    
    RenderForm --> FillForm["User fills form fields"]
    FillForm --> ValidateFields{"Validate all fields"}
    
    ValidateFields -->|"Invalid"| ShowErrors["Display validation errors"]
    ValidateFields -->|"Valid"| CreateAccount["createAccount() action"]
    
    CreateAccount --> PerformCreation["performAccountCreation()"]
    PerformCreation --> ServerRequest["POST /u with user data"]
    
    ServerRequest -->|"Success"| HiddenSubmit["Submit hidden-login-form"]
    ServerRequest -->|"Error"| DisplayError["Show error message"]
    
    HiddenSubmit --> AccountCreated["Redirect to /u/account-created"]
```

**Sources:** [app/assets/javascripts/discourse/app/routes/signup.js:23-93](https://github.com/discourse/discourse/blob/8c2d5f9a/app/assets/javascripts/discourse/app/routes/signup.js#L23-L93), [app/assets/javascripts/discourse/app/controllers/signup.js:554-588](https://github.com/discourse/discourse/blob/8c2d5f9a/app/assets/javascripts/discourse/app/controllers/signup.js#L554-L588)

### Signup Controller Validation System

The `SignupPageController` uses multiple validation helpers for comprehensive form validation:

```mermaid
graph LR
    SignupController --> UsernameValidationHelper["UsernameValidationHelper"]
    SignupController --> PasswordValidationHelper["PasswordValidationHelper"] 
    SignupController --> NameValidationHelper["NameValidationHelper"]
    SignupController --> UserFieldsValidationHelper["UserFieldsValidationHelper"]
    
    UsernameValidationHelper --> CheckUsername["checkUsernameAvailability()"]
    PasswordValidationHelper --> CheckPassword["passwordValidation computed"]
    NameValidationHelper --> CheckName["nameValidation computed"]
    UserFieldsValidationHelper --> CheckUserFields["userFieldsValidation computed"]
```

**Core Validation Properties:**
- `usernameValidation` - Real-time username availability checking at [app/assets/javascripts/discourse/app/controllers/signup.js:94-96]()
- `passwordValidation` - Password strength and requirements at [app/assets/javascripts/discourse/app/controllers/signup.js:99-101]()
- `emailValidation` - Email format and availability validation at [app/assets/javascripts/discourse/app/controllers/signup.js:237-293]()
- `userFieldsValidation` - Custom user field validation at [app/assets/javascripts/discourse/app/controllers/signup.js:89-91]()

**Sources:** [app/assets/javascripts/discourse/app/controllers/signup.js:26-590](https://github.com/discourse/discourse/blob/8c2d5f9a/app/assets/javascripts/discourse/app/controllers/signup.js#L26-L590), [app/assets/javascripts/discourse/app/lib/username-validation-helper.js:21-136](https://github.com/discourse/discourse/blob/8c2d5f9a/app/assets/javascripts/discourse/app/lib/username-validation-helper.js#L21-L136)

## Social Authentication UI

Social authentication integrates external OAuth providers with the signup and login flows, providing seamless third-party authentication.

### Social Authentication Flow

```mermaid
graph TD
    SocialButton["User clicks social login button"] --> ExternalLogin["externalLogin() action"]
    ExternalLogin --> LoginService["LoginService.externalLogin()"]
    LoginService --> LoginMethod["LoginMethod.doLogin()"]
    LoginMethod --> ExternalSite["Redirect to external provider"]
    
    ExternalSite --> AuthCallback["OAuth callback returns"]
    AuthCallback --> AuthComplete["auth-complete.js initializer"]
    
    AuthComplete --> CheckResult{"Authentication result"}
    CheckResult -->|"Success"| RedirectHome["Redirect to destination"]
    CheckResult -->|"New user"| SignupForm["Pre-fill signup form"]
    CheckResult -->|"Error"| ShowError["Display auth error"]
    
    SignupForm --> AuthOptions["Set authOptions on controller"]
    AuthOptions --> PrefilledForm["Show form with disabled fields"]
    PrefilledForm --> SkipConfirm{"Skip confirmation?"}
    
    SkipConfirm -->|"Yes"| AutoCreate["Auto-create account"]
    SkipConfirm -->|"No"| ManualSubmit["User submits form"]
```

**Sources:** [app/assets/javascripts/discourse/app/instance-initializers/auth-complete.js:25-118](https://github.com/discourse/discourse/blob/8c2d5f9a/app/assets/javascripts/discourse/app/instance-initializers/auth-complete.js#L25-L118), [app/assets/javascripts/discourse/app/services/login.js:11-21](https://github.com/discourse/discourse/blob/8c2d5f9a/app/assets/javascripts/discourse/app/services/login.js#L11-L21)

### Social Provider Integration

The system supports multiple OAuth providers through a unified interface:

| Provider | Configuration | Features |
|----------|---------------|----------|
| Facebook | `enable_facebook_logins` | Full profile import |
| Google | `enable_google_oauth2_logins` | Email verification |
| GitHub | `enable_github_logins` | Username suggestions |
| Twitter | `enable_twitter_logins` | Manual email entry |
| Discord | `enable_discord_logins` | Username/email import |
| LinkedIn | `enable_linkedin_oidc_logins` | Professional profile |

**Sources:** [spec/system/social_authentication_spec.rb:16-536](https://github.com/discourse/discourse/blob/8c2d5f9a/spec/system/social_authentication_spec.rb#L16-L536)

## Form Validation System

The validation system provides real-time feedback and comprehensive field validation across all authentication forms.

### Validation Helper Architecture

```mermaid
graph TB
    subgraph "Username Validation"
        UsernameHelper["UsernameValidationHelper"] 
        UsernameHelper --> BasicValidation["basicUsernameValidation()"]
        UsernameHelper --> AvailabilityCheck["checkUsernameAvailability()"]
        BasicValidation --> LengthCheck["Length requirements"]
        AvailabilityCheck --> ServerCheck["User.checkUsername()"]
    end
    
    subgraph "Password Validation"
        PasswordHelper["PasswordValidationHelper"]
        PasswordHelper --> StrengthCheck["Password strength"]
        PasswordHelper --> CommonCheck["Common password check"]
        PasswordHelper --> SimilarityCheck["Username/email similarity"]
    end
    
    subgraph "User Fields Validation"
        UserFieldsHelper["UserFieldsValidationHelper"]
        UserFieldsHelper --> TrackedUserField["TrackedUserField instances"]
        TrackedUserField --> RequiredCheck["Required field validation"]
        TrackedUserField --> CustomValidation["Custom validation callbacks"]
    end
    
    subgraph "Email Validation"
        EmailValidation["emailValidation computed property"]
        EmailValidation --> FormatCheck["Email format validation"]
        EmailValidation --> ServerValidation["User.checkEmail()"]
        EmailValidation --> DomainCheck["Blocked domain check"]
    end
```

**Validation States:**
- `ok: true` - Field is valid, show success indicator
- `failed: true` - Field is invalid, show error message  
- `shouldCheck: true` - Trigger server-side validation
- `reason` - Specific validation message to display

**Sources:** [app/assets/javascripts/discourse/app/lib/username-validation-helper.js:78-135](https://github.com/discourse/discourse/blob/8c2d5f9a/app/assets/javascripts/discourse/app/lib/username-validation-helper.js#L78-L135), [app/assets/javascripts/discourse/app/lib/password-validation-helper.js:40-103](https://github.com/discourse/discourse/blob/8c2d5f9a/app/assets/javascripts/discourse/app/lib/password-validation-helper.js#L40-L103), [app/assets/javascripts/discourse/app/lib/user-fields-validation-helper.js:78-116](https://github.com/discourse/discourse/blob/8c2d5f9a/app/assets/javascripts/discourse/app/lib/user-fields-validation-helper.js#L78-L116)

## Authentication Completion Flow

The authentication completion system handles post-authentication redirects and account setup through the `auth-complete.js` initializer.

### Auth Completion Process

```mermaid
graph TD
    AuthData["#data-authentication element"] --> AuthComplete["auth-complete.js initializer"]
    AuthComplete --> ParseData["JSON.parse() authentication data"]
    ParseData --> CheckCallbacks["Run beforeAuthCompleteCallbacks"]
    
    CheckCallbacks --> CheckRoute{"Current route?"}
    CheckRoute -->|"invites.show"| InviteFlow["InvitesShowController.authenticationComplete()"]
    CheckRoute -->|"Other"| MainFlow["Main auth flow"]
    
    MainFlow --> CheckErrors{"Authentication errors?"}
    CheckErrors -->|"Has errors"| LoginError["Redirect to login with error"]
    CheckErrors -->|"Suspended"| SuspendedError["Show suspension message"]  
    CheckErrors -->|"Success"| CheckAuth{"Authenticated?"}
    
    CheckAuth -->|"Yes"| Redirect["Redirect to destination_url"]
    CheckAuth -->|"No"| SetupSignup["Setup signup controller"]
    
    SetupSignup --> SignupProps["Set authOptions, accountEmail, etc"]
    SignupProps --> SkipConfirm{"skipConfirmation?"}
    SkipConfirm -->|"Yes"| HandleSkip["handleSkipConfirmation()"]
    SkipConfirm -->|"No"| ShowSignup["Show signup form"]
```

**Error Handling:**
The system handles various authentication errors defined in `AuthErrors` array:
- `admin_not_allowed_from_ip_address`
- `awaiting_activation` 
- `awaiting_approval`
- `not_allowed_from_ip_address`
- `requires_invite`

**Sources:** [app/assets/javascripts/discourse/app/instance-initializers/auth-complete.js:7-118](https://github.com/discourse/discourse/blob/8c2d5f9a/app/assets/javascripts/discourse/app/instance-initializers/auth-complete.js#L7-L118)

## Invite-Based Registration

The invite system provides specialized registration flows for users accepting invitations to join the forum.

### Invite Controller Features

The `InvitesShowController` extends the base signup functionality with invite-specific features:

- **Email Handling**: Pre-populates or validates against invite email at [app/assets/javascripts/discourse/app/controllers/invites-show.js:225-296]()
- **External Auth Integration**: Supports OAuth with invite context at [app/assets/javascripts/discourse/app/controllers/invites-show.js:96-108]()  
- **User Field Support**: Includes custom user fields in invite signup at [app/assets/javascripts/discourse/app/controllers/invites-show.js:63-70]()
- **Validation Integration**: Uses the same validation helpers as regular signup at [app/assets/javascripts/discourse/app/controllers/invites-show.js:25-44]()