# Frontend Build System

<details>
<summary>Relevant source files</summary>

The following files were used as context for generating this wiki page:

- [app/assets/javascripts/admin/package.json](https://github.com/discourse/discourse/blob/8c2d5f9a/app/assets/javascripts/admin/package.json)
- [app/assets/javascripts/deprecation-silencer/package.json](https://github.com/discourse/discourse/blob/8c2d5f9a/app/assets/javascripts/deprecation-silencer/package.json)
- [app/assets/javascripts/dialog-holder/package.json](https://github.com/discourse/discourse/blob/8c2d5f9a/app/assets/javascripts/dialog-holder/package.json)
- [app/assets/javascripts/discourse-i18n/package.json](https://github.com/discourse/discourse/blob/8c2d5f9a/app/assets/javascripts/discourse-i18n/package.json)
- [app/assets/javascripts/discourse-markdown-it/package.json](https://github.com/discourse/discourse/blob/8c2d5f9a/app/assets/javascripts/discourse-markdown-it/package.json)
- [app/assets/javascripts/discourse-plugins/package.json](https://github.com/discourse/discourse/blob/8c2d5f9a/app/assets/javascripts/discourse-plugins/package.json)
- [app/assets/javascripts/discourse-widget-hbs/package.json](https://github.com/discourse/discourse/blob/8c2d5f9a/app/assets/javascripts/discourse-widget-hbs/package.json)
- [app/assets/javascripts/discourse/package.json](https://github.com/discourse/discourse/blob/8c2d5f9a/app/assets/javascripts/discourse/package.json)
- [app/assets/javascripts/float-kit/package.json](https://github.com/discourse/discourse/blob/8c2d5f9a/app/assets/javascripts/float-kit/package.json)
- [app/assets/javascripts/pretty-text/package.json](https://github.com/discourse/discourse/blob/8c2d5f9a/app/assets/javascripts/pretty-text/package.json)
- [app/assets/javascripts/select-kit/package.json](https://github.com/discourse/discourse/blob/8c2d5f9a/app/assets/javascripts/select-kit/package.json)
- [app/assets/javascripts/theme-transpiler/package.json](https://github.com/discourse/discourse/blob/8c2d5f9a/app/assets/javascripts/theme-transpiler/package.json)
- [app/assets/javascripts/truth-helpers/package.json](https://github.com/discourse/discourse/blob/8c2d5f9a/app/assets/javascripts/truth-helpers/package.json)
- [package.json](https://github.com/discourse/discourse/blob/8c2d5f9a/package.json)
- [pnpm-lock.yaml](https://github.com/discourse/discourse/blob/8c2d5f9a/pnpm-lock.yaml)

</details>



This document covers Discourse's JavaScript build pipeline, which transforms the frontend codebase from source files into deployable assets. The system uses pnpm workspaces to manage multiple Ember.js packages, with Embroider and Webpack powering the modern build pipeline.

For information about theme compilation and asset processing, see [Theme and Asset Compilation](#2.2). For backend Ruby build processes, see [Ruby Application Architecture](#3.1).

## Package Management Architecture

Discourse uses a monorepo structure managed by pnpm workspaces, with the main application split into multiple specialized packages. This modular approach enables independent development and testing of different UI components while maintaining shared dependencies.

```mermaid
graph TB
    root["Root Package<br/>discourse"]
    
    subgraph "Core Packages"
        discourse_pkg["discourse<br/>(Main App)"]
        admin["admin<br/>(Admin Interface)"]
        plugins["discourse-plugins<br/>(Plugin System)"]
    end
    
    subgraph "UI Component Packages"
        float_kit["float-kit<br/>(Floating Panels)"]
        select_kit["select-kit<br/>(Select Widgets)"]
        dialog_holder["dialog-holder<br/>(Modal Dialogs)"]
    end
    
    subgraph "Text Processing Packages"
        pretty_text["pretty-text<br/>(Text Rendering)"]
        markdown_it["discourse-markdown-it<br/>(Markdown Processing)"]
        widget_hbs["discourse-widget-hbs<br/>(Widget Templates)"]
    end
    
    subgraph "Utility Packages"
        i18n["discourse-i18n<br/>(Internationalization)"]
        truth_helpers["truth-helpers<br/>(Template Helpers)"]
        theme_transpiler["theme-transpiler<br/>(Theme Compilation)"]
        custom_proxy["custom-proxy<br/>(Development Proxy)"]
    end
    
    root --> discourse_pkg
    root --> admin
    root --> plugins
    root --> float_kit
    root --> select_kit
    root --> dialog_holder
    root --> pretty_text
    root --> markdown_it
    root --> widget_hbs
    root --> i18n
    root --> truth_helpers
    root --> theme_transpiler
    root --> custom_proxy
    
    discourse_pkg --> admin
    discourse_pkg --> float_kit
    discourse_pkg --> select_kit
    discourse_pkg --> dialog_holder
    discourse_pkg --> pretty_text
    discourse_pkg --> i18n
    discourse_pkg --> truth_helpers
    
    admin --> i18n
    plugins --> widget_hbs
    markdown_it --> pretty_text
    markdown_it --> i18n
```

Sources: [pnpm-lock.yaml:30-1039](https://github.com/discourse/discourse/blob/8c2d5f9a/pnpm-lock.yaml#L30-L1039), [package.json:1-91](https://github.com/discourse/discourse/blob/8c2d5f9a/package.json#L1-L91)

## Workspace Structure

The frontend codebase is organized as a pnpm workspace with each package residing in `app/assets/javascripts/`. Each package has its own `package.json` defining dependencies and build scripts.

| Package | Path | Purpose |
|---------|------|---------|
| `discourse` | `/discourse` | Main Ember.js application |
| `admin` | `/admin` | Administrative interface |
| `float-kit` | `/float-kit` | Floating UI components (tooltips, dropdowns) |
| `select-kit` | `/select-kit` | Select input components |
| `pretty-text` | `/pretty-text` | Text rendering utilities |
| `discourse-i18n` | `/discourse-i18n` | Internationalization system |
| `discourse-markdown-it` | `/discourse-markdown-it` | Markdown processing |
| `theme-transpiler` | `/theme-transpiler` | Theme compilation utilities |

Sources: [app/assets/javascripts/discourse/package.json:1-164](https://github.com/discourse/discourse/blob/8c2d5f9a/app/assets/javascripts/discourse/package.json#L1-L164), [app/assets/javascripts/admin/package.json:1-53](https://github.com/discourse/discourse/blob/8c2d5f9a/app/assets/javascripts/admin/package.json#L1-L53), [app/assets/javascripts/float-kit/package.json:1-57](https://github.com/discourse/discourse/blob/8c2d5f9a/app/assets/javascripts/float-kit/package.json#L1-L57)

## Build Pipeline Architecture

The build system transforms source code through multiple stages, from TypeScript/JavaScript source files to optimized browser bundles. Embroider provides the modern build pipeline while maintaining compatibility with classic Ember addons.

```mermaid
graph TB
    subgraph "Source Files"
        ts_files["TypeScript Files<br/>(.ts, .gts)"]
        js_files["JavaScript Files<br/>(.js, .gjs)"]
        hbs_files["Handlebars Templates<br/>(.hbs)"]
        scss_files["SCSS Stylesheets<br/>(.scss)"]
    end
    
    subgraph "Transpilation Layer"
        babel["Babel<br/>(ES6+ â†’ ES5)"]
        ember_template["ember-template-imports<br/>(Template Compilation)"]
        typescript["TypeScript Compiler<br/>(Type Checking)"]
    end
    
    subgraph "Embroider Pipeline"
        embroider_compat["@embroider/compat<br/>(Legacy Addon Support)"]
        embroider_core["@embroider/core<br/>(Build Coordination)"]
        embroider_webpack["@embroider/webpack<br/>(Webpack Integration)"]
    end
    
    subgraph "Webpack Processing"
        webpack["Webpack 5.101.3<br/>(Module Bundling)"]
        auto_import["ember-auto-import<br/>(NPM Package Import)"]
        terser["Terser<br/>(Minification)"]
    end
    
    subgraph "Output Assets"
        js_bundles["JavaScript Bundles<br/>(app.js, vendor.js)"]
        css_bundles["CSS Bundles<br/>(app.css)"]
        source_maps["Source Maps<br/>(.map files)"]
    end
    
    ts_files --> typescript
    ts_files --> babel
    js_files --> babel
    hbs_files --> ember_template
    scss_files --> webpack
    
    typescript --> embroider_compat
    babel --> embroider_compat
    ember_template --> embroider_compat
    
    embroider_compat --> embroider_core
    embroider_core --> embroider_webpack
    embroider_webpack --> webpack
    
    webpack --> auto_import
    webpack --> terser
    auto_import --> js_bundles
    terser --> js_bundles
    webpack --> css_bundles
    webpack --> source_maps
```

Sources: [app/assets/javascripts/discourse/package.json:66-153](https://github.com/discourse/discourse/blob/8c2d5f9a/app/assets/javascripts/discourse/package.json#L66-L153), [pnpm-lock.yaml:426-440](https://github.com/discourse/discourse/blob/8c2d5f9a/pnpm-lock.yaml#L426-L440)

## Ember CLI Integration

Each package is configured as an Ember CLI application or addon, with standardized build scripts and development workflows. The main `discourse` package serves as the host application while other packages function as in-repo addons.

```mermaid
graph TB
    subgraph "Ember CLI Commands"
        ember_build["ember build<br/>(Production Build)"]
        ember_serve["ember serve<br/>(Development Server)"]
        ember_test["ember test<br/>(Test Runner)"]
    end
    
    subgraph "Build Configuration"
        ember_cli_build["ember-cli-build.js<br/>(Build Configuration)"]
        ember_json[".ember-cli<br/>(CLI Options)"]
        testem_json["testem.js<br/>(Test Configuration)"]
    end
    
    subgraph "Ember Addons"
        ember_cli_babel["ember-cli-babel<br/>(Babel Integration)"]
        ember_cli_htmlbars["ember-cli-htmlbars<br/>(Template Compilation)"]
        ember_cli_terser["ember-cli-terser<br/>(Minification)"]
        ember_auto_import_addon["ember-auto-import<br/>(NPM Import)"]
    end
    
    subgraph "Development Tools"
        live_reload["ember-cli-inject-live-reload<br/>(Hot Reloading)"]
        source_maps["broccoli-asset-rev<br/>(Asset Fingerprinting)"]
        sri["ember-cli-sri<br/>(Subresource Integrity)"]
    end
    
    ember_build --> ember_cli_build
    ember_serve --> ember_cli_build
    ember_test --> testem_json
    
    ember_cli_build --> ember_cli_babel
    ember_cli_build --> ember_cli_htmlbars
    ember_cli_build --> ember_cli_terser
    ember_cli_build --> ember_auto_import_addon
    
    ember_serve --> live_reload
    ember_build --> source_maps
    ember_build --> sri
```

Sources: [app/assets/javascripts/discourse/package.json:16-20](https://github.com/discourse/discourse/blob/8c2d5f9a/app/assets/javascripts/discourse/package.json#L16-L20), [app/assets/javascripts/admin/package.json:10-15](https://github.com/discourse/discourse/blob/8c2d5f9a/app/assets/javascripts/admin/package.json#L10-L15)

## Dependency Management

The build system manages complex dependency relationships between packages using workspace references and peer dependencies. Critical shared dependencies are coordinated at the root level to prevent version conflicts.

| Dependency Type | Examples | Purpose |
|----------------|----------|---------|
| Framework | `ember-source@~6.6.0`, `@glimmer/component` | Core Ember.js framework |
| Build Tools | `@embroider/webpack`, `webpack@5.101.3` | Modern build pipeline |
| Transpilation | `@babel/core`, `ember-cli-babel` | JavaScript transformation |
| Testing | `qunit`, `ember-qunit`, `@ember/test-helpers` | Test framework integration |
| UI Libraries | `@floating-ui/dom`, `prosemirror-*` | External UI components |

Sources: [app/assets/javascripts/discourse/package.json:66-153](https://github.com/discourse/discourse/blob/8c2d5f9a/app/assets/javascripts/discourse/package.json#L66-L153), [pnpm-lock.yaml:7-28](https://github.com/discourse/discourse/blob/8c2d5f9a/pnpm-lock.yaml#L7-L28)

## Development Workflow

The development environment provides hot reloading, source maps, and integrated testing. The `custom-proxy` package enables proxying between the Ember development server and Rails backend during local development.

```mermaid
graph LR
    subgraph "Development Commands"
        pnpm_dev["pnpm dev<br/>(Concurrent Rails + Ember)"]
        ember_serve_cmd["ember serve<br/>(Development Server)"]
        rails_server["rails server<br/>(Backend API)"]
    end
    
    subgraph "Build Process"
        file_watch["File Watcher<br/>(Source Changes)"]
        incremental_build["Incremental Build<br/>(Changed Files Only)"]
        live_reload_inject["Live Reload<br/>(Browser Refresh)"]
    end
    
    subgraph "Development Assets"
        unminified_js["Unminified JS<br/>(Fast Build)"]
        source_maps_dev["Source Maps<br/>(Debugging)"]
        hot_reload["Hot Module Replacement<br/>(Component Updates)"]
    end
    
    pnpm_dev --> ember_serve_cmd
    pnpm_dev --> rails_server
    ember_serve_cmd --> file_watch
    file_watch --> incremental_build
    incremental_build --> live_reload_inject
    incremental_build --> unminified_js
    incremental_build --> source_maps_dev
    incremental_build --> hot_reload
```

Sources: [package.json:42-43](https://github.com/discourse/discourse/blob/8c2d5f9a/package.json#L42-L43), [app/assets/javascripts/custom-proxy/package.json:1-31](https://github.com/discourse/discourse/blob/8c2d5f9a/app/assets/javascripts/custom-proxy/package.json#L1-L31)

## TypeScript Integration

The build system includes TypeScript support with Glint for template type checking. Type definitions are shared across packages through workspace references.

```mermaid
graph TB
    subgraph "TypeScript Configuration"
        tsconfig["tsconfig.json<br/>(Compiler Options)"]
        glint_config["Glint Configuration<br/>(Template Types)"]
        type_deps["@types/* Packages<br/>(Type Definitions)"]
    end
    
    subgraph "Type Checking Process"
        tsc["TypeScript Compiler<br/>(tsc)"]
        glint_core["@glint/core<br/>(Template Type Checker)"]
        glint_env["@glint/environment-ember-loose<br/>(Ember Integration)"]
    end
    
    subgraph "Build Integration"
        babel_ts["Babel TypeScript<br/>(Transpilation)"]
        webpack_ts["Webpack TS Loader<br/>(Bundle Integration)"]
        source_maps_ts["TypeScript Source Maps<br/>(Debugging)"]
    end
    
    tsconfig --> tsc
    glint_config --> glint_core
    type_deps --> tsc
    
    tsc --> babel_ts
    glint_core --> glint_env
    glint_env --> webpack_ts
    
    babel_ts --> webpack_ts
    webpack_ts --> source_maps_ts
```