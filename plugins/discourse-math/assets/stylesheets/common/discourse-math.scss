// Hidden state for math elements during rendering
.math-hidden {
  display: none !important;
}

.math-container {
  &.block-math,
  &.ascii-math {
    display: block;

    // we use tag selectors because MathJax does not provide helpful classes
    // and the possible combinations a bit absurd. The styles are scoped by the
    // parent selector. So they don't affect any other elements.
    > {
      div,
      span,
      mjx-container {
        // Mathjax ships with !important inline;
        display: block !important;
        max-width: 100%;
        margin-bottom: 1em;

        // special handling for katex
        .katex-html {
          display: block;
          overflow-x: auto;
          overflow-y: hidden;
          max-width: 100%;
          padding: 0.25em 0.5em;
          box-sizing: border-box;
        }
      }

      // MathJax 4 container - overflow only on the container itself
      mjx-container {
        overflow-x: auto;
        overflow-y: hidden;
        max-width: 100%;
        padding: 0.25em 0.5em;
        box-sizing: border-box;
      }
    }

    // On mobile we add a slight fade on either side to indicate that the user can
    // scroll. However, this should not be added to the composer since mathjax does
    // not render in the mobile composer
    .cooked & {
      .mobile-view & {
        position: relative;

        &::before {
          content: "";
          position: absolute;
          z-index: 1;
          left: 0;
          top: 0;
          width: 1em;
          height: 100%;
          background: linear-gradient(
            to right,
            rgb(var(--secondary-rgb), 1) 0%,
            rgb(var(--secondary-rgb), 0) 100%
          );
        }

        &::after {
          content: "";
          position: absolute;
          z-index: 1;
          right: 0;
          top: 0;
          width: 1em;
          height: 100%;
          background: linear-gradient(
            to right,
            rgb(var(--secondary-rgb), 0) 0%,
            rgb(var(--secondary-rgb), 1) 100%
          );
        }
      }
    }
  }
}

.ProseMirror {
  .composer-math-node {
    position: relative;
    display: inline-flex;
    align-items: baseline;
    gap: var(--space-half);
    padding: 0 var(--space-1);
    border: 1px dashed var(--primary-low-mid);
    border-radius: var(--d-border-radius);
    background: var(--primary-very-low);
    font-family: var(--d-font-family--monospace);

    &.ProseMirror-selectednode {
      outline-offset: -2px;
      border-color: var(--tertiary);
    }

    .math-node-edit-button {
      color: var(--primary-medium);
      padding: 0;

      &:hover {
        color: var(--primary);
      }
    }

    .math-node-content {
      font-size: var(--font-down-1);
    }
  }

  div.composer-math-node {
    display: block;
    padding: var(--space-2);
    margin: var(--space-2) 0;

    .math-node-content {
      display: block;
      white-space: pre-wrap;
    }
  }
}

.math-insert-modal,
.math-edit-modal {
  &__toggle {
    margin-bottom: var(--space-3);
  }

  &__textarea {
    min-height: 100px;
    font-family: var(--d-font-family--monospace);
  }
}
