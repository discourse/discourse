<section id="d-splash">
  <style>
    html {
      overflow-y: hidden !important;
    }

    /* user picked a theme where the "regular" scheme is dark */
    <%- if dark_color_scheme? %>
      html {
        background-color: #<%= light_color_hex_for_name("secondary") %>;
      }

      #d-splash {
        --dot-color: #<%= light_color_hex_for_name("tertiary") %>;
      }
    <%- elsif forced_light_mode? %>
      html {
        background-color: #<%= light_color_hex_for_name("secondary") %>;
      }

      #d-splash {
        --dot-color: #<%= light_color_hex_for_name("tertiary") %>;
      }
    <%- elsif forced_dark_mode? %>
      html {
        background-color: #<%= dark_color_hex_for_name("secondary") %>;
      }

      #d-splash {
        --dot-color: #<%= dark_color_hex_for_name("tertiary") %>;
      }
    <%- else %>
      /* user picked a theme a light scheme and also enabled a dark scheme */

      /* deal with light scheme first */
      @media (prefers-color-scheme: light) {
        html {
          background-color: #<%= light_color_hex_for_name("secondary") %>;
        }

        #d-splash {
          --dot-color: #<%= light_color_hex_for_name("tertiary") %>;
        }
      }

      /* then deal with dark scheme */
      @media (prefers-color-scheme: dark) {
        html {
          background-color: #<%= dark_color_hex_for_name("secondary") %>;
        }

        #d-splash {
          --dot-color: #<%= dark_color_hex_for_name("tertiary") %>;
        }
      }
    <%- end %>

    #d-splash {
      display: grid;
      place-items: center;
      position: absolute;
      left: 0;
      top: 0;
      width: 100vw;
      z-index: 1001;
    }

    #d-splash .preloader-image {
      --splash-dot-size: max(1vw, 25px);
      --splash-dot-spacing: calc(var(--splash-dot-size) * 1.5);
      width: calc((var(--splash-dot-size) + var(--splash-dot-spacing)) * 5);
      height: 100vh;
      background-size: cover;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 3rem;
    }

    @keyframes d-splash-fade-in {
      0% {
        opacity: 0;
      }
      100% {
        opacity: 1;
      }
    }

    #d-splash .dots-container {
      position: relative;
      width: calc((var(--splash-dot-size) + var(--splash-dot-spacing)) * 5);
      height: var(--splash-dot-size);
    }

    .dots {
      animation-name: d-splash-loader;
      animation-timing-function: ease-in-out;
      animation-duration: 3s;
      animation-iteration-count: infinite;
      animation-delay: calc(var(--n) * 0.15s);

      position: absolute;
      top: 0;
      left: calc((50% - var(--splash-dot-size) / 2) + (var(--n) * var(--splash-dot-spacing)));
      transform-origin: calc((var(--splash-dot-spacing) * var(--n) * -1) + var(--splash-dot-size)/2) center;

      width: var(--splash-dot-size);
      height: var(--splash-dot-size);
      border-radius: 50%;

      background-color: var(--dot-color);
      filter: saturate(2) opacity(0.85);
      opacity: 0;
    }

    @keyframes d-splash-loader {
      0% {
        opacity: 0;
        transform: scale(1);
      }
      45% {
        opacity: 1;
        transform: scale(0.7);
      }
      65% {
        opacity: 1;
        transform: scale(0.7);
      }
      100% {
        opacity: 0;
        transform: scale(1);
      }
    }

    <%- if (logo_upload = SiteSetting.splash_screen_image) && logo_upload.is_a?(Upload) %>
    #d-splash .preloader-image {
      --splash-dot-size: max(0.7vw, 14px);
    }

    #d-splash .splash-logo-container {
      width: min(300px, 80vw);
      height: 80px;
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
      background-image: url("<%= splash_screen_image_data_uri %>");
      <%- unless splash_screen_image_animated? %>
      opacity: 0.4;
      animation: d-splash-logo-pulse 3s ease-in-out infinite;
      <%- end %>
    }

    @keyframes d-splash-logo-pulse {
      0%, 100% {
        opacity: 0.4;
      }
      25%, 65% {
        opacity: 1;
      }
    }
    <%- end %>
  </style>

  <div class="preloader-image" elementtiming="discourse-splash-visible">
    <%- if (logo_upload = SiteSetting.splash_screen_image) && logo_upload.is_a?(Upload) %>
      <div class="splash-logo-container"></div>
    <%- end %>
    <%- unless splash_screen_image_animated? %>
      <div class="dots-container">
        <div class="dots" style="--n:-2;"></div>
        <div class="dots" style="--n:-1;"></div>
        <div class="dots" style="--n:0;"></div>
        <div class="dots" style="--n:1;"></div>
        <div class="dots" style="--n:2;"></div>
      </div>
    <%- end %>
  </div>
  <script nonce="<%= csp_nonce_placeholder %>">
    const svg = `<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1"><!-- LCP candidate image ${".".repeat(5000)} --></svg>`;
    document.querySelector("#d-splash .preloader-image").style.backgroundImage = `url('data:image/svg+xml,${svg}')`
  </script>

  <noscript>
    <style>
      html {
        overflow-y: revert !important;
      }

      #d-splash {
        display: none;
      }
    </style>
  </noscript>
</section>
